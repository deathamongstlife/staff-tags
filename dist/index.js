(function(E,h,c,f,g,u,C,D,R){"use strict";const{Permissions:v}=f.constants,L=c.findByProps("computePermissions","canEveryoneRole"),b=L?.computePermissions,O=c.findByStoreName("GuildMemberStore"),B=[f.i18n?.Messages?.AI_TAG,f.i18n?.Messages?.BOT_TAG_SERVER,f.i18n?.Messages?.SYSTEM_DM_TAG_SYSTEM,f.i18n?.Messages?.GUILD_AUTOMOD_USER_BADGE_TEXT,f.i18n?.Messages?.REMIXING_TAG].filter(Boolean),P=[{text:"WEBHOOK",condition:function(t,r,e){return e?.isNonUserBot?.()}},{text:"OWNER",backgroundColor:u.rawColors.ORANGE_345,condition:function(t,r,e){return t?.ownerId===e?.id}},{text:f.i18n?.Messages?.BOT_TAG_BOT||"BOT",condition:function(t,r,e){return e?.bot},verified:function(t,r,e){return e?.isVerifiedBot?.()}},{text:"ADMIN",backgroundColor:u.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:u.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:u.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function T(t,r,e){try{if(!e)return null;let s;if(t&&b&&v)try{const o=b({user:e,context:t,overwrites:r?.permissionOverwrites});s=Object.entries(v).map(function(n){let[l,a]=n;return o&a?l:""}).filter(Boolean)}catch(o){console.error("Staff Tags - Permission computation error:",o),s=[]}for(const o of P)try{const n=o.condition?.(t,r,e),l=o.permissions?.some(function(a){return s?.includes(a)});if(n||l){let a;if(h.storage.useRoleColor&&t?.id&&e?.id)try{a=O?.getMember?.(t.id,e.id)?.colorString}catch(p){console.error("Staff Tags - Role color error:",p)}let d=a||o.backgroundColor||u.rawColors.BRAND_500,i;try{i=a||!o.textColor?f.chroma(d).get("lab.l")<70?u.rawColors.WHITE_500:u.rawColors.BLACK_500:o.textColor}catch{i=u.rawColors.WHITE_500}return{...o,textColor:i,backgroundColor:d,verified:typeof o.verified=="function"?o.verified(t,r,e):o.verified??!1,condition:void 0,permissions:void 0}}}catch(n){console.error("Staff Tags - Tag processing error:",n);continue}return null}catch(s){return console.error("Staff Tags - getTag error:",s),null}}const _=c.findByName("getTagProperties",!1),U=c.findByStoreName("GuildStore"),$=c.findByStoreName("ChannelStore");function H(){return _?g.after("default",_,function(t,r){let[{message:e}]=t;try{if(!r||!e||B.includes(r.tagText))return r;const s=$?.getChannel?.(e.channel_id),o=U?.getGuild?.(s?.guild_id),n=T(o,s,e.author);if(n)return{...r,tagText:n.text,tagTextColor:n.textColor?f.ReactNative.processColor(f.chroma(n.textColor).hex()):void 0,tagBackgroundColor:n.backgroundColor?f.ReactNative.processColor(f.chroma(n.backgroundColor).hex()):void 0,tagVerified:n.verified,tagType:void 0}}catch(s){console.error("Staff Tags - Chat patch error:",s)}return r}):(console.error("Staff Tags - getTagProperties not found"),function(){})}const S=c.findByProps("getBotLabel"),G=c.findByStoreName("GuildStore"),I=c.findByName("DefaultName",!1),M=c.findByName("DisplayName",!1);function K(){const t=[];return I&&t.push(g.after("default",I,function(r,e){let[s]=r;try{const o=s?.user,n=s?.guildId;if(!o||!e)return e;const l=G?.getGuild?.(n),a=T(l,null,o);a&&S?.default&&e.props?.children[0]?.props?.children?.push(React.createElement(S.default,{type:0,text:a.text+"[DEFAULT]",textColor:a.textColor,backgroundColor:a.backgroundColor,verified:a.verified}))}catch{}return e})),M&&t.push(g.after("default",M,function(r,e){let[s]=r;try{const o=s?.user,n=s?.guildId;if(!o||!e)return e;const l=G?.getGuild?.(n),a=T(l,null,o);a&&S?.default&&e.props?.children?.props?.children[0]?.props?.children?.push(React.createElement(S.default,{type:0,text:a.text+"[DISPLAY]",textColor:a.textColor,backgroundColor:a.backgroundColor,verified:a.verified}))}catch{}return e})),function(){t.forEach(function(r){try{r?.()}catch{}})}}const k=c.findByName("DisplayName",!1),m=c.findByName("HeaderName",!1),x=c.findByProps("getBotLabel"),w=x?.getBotLabel,V=c.findByStoreName("GuildStore"),W=c.findByStoreName("ChannelStore");function F(){const t=[];return m&&t.push(g.after("default",m,function(r,e){let[{channelId:s}]=r;try{e?.props&&(e.props.channelId=s)}catch(o){console.error("Staff Tags - HeaderName patch error:",o)}})),k&&t.push(g.after("default",k,function(r,e){let[{guildId:s,channelId:o,user:n}]=r;try{if(!e||!w)return;const l=C.findInReactTree(e,function(a){return a?.type?.Types});if(!l||!B.includes(w(l.props?.type))){const a=V?.getGuild?.(s),d=W?.getChannel?.(o),i=T(a,d,n);if(i&&x?.default)if(l)l.props={type:0,...i};else{const p=C.findInReactTree(e,function(A){return A?.props?.style?.flexDirection==="row"});p?.props?.children&&Array.isArray(p.props.children)&&p.props.children.push(React.createElement(x.default,{style:{marginLeft:0},type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}}catch(l){console.error("Staff Tags - DisplayName patch error:",l)}})),function(){return t.forEach(function(r){try{r?.()}catch(e){console.error("Staff Tags - Name unpatch error:",e)}})}}const N=c.findByProps("getBotLabel"),Y=N?.getBotLabel,j=c.findByStoreName("GuildStore");function X(){const t=[],r=function(e,s){let[{guildId:o,channel:n,user:l}]=e;try{if(!s||!l||!o)return s;const a=C.findInReactTree(s,function(d){return d?.type?.Types});if(!a||!B.includes(Y?.(a.props?.type))){const d=j?.getGuild?.(o),i=T(d,n,l);if(i&&N?.default)if(a)a.props={type:0,...i};else{const p=C.findInReactTree(s,function(A){return A?.props?.style?.flexDirection==="row"});p?.props?.children&&p.props.children.splice(2,0,React.createElement(N.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}}catch{}return s};return c.findByTypeNameAll("UserRow").forEach(function(e){return t.push(g.after("type",e,r))}),function(){t.forEach(function(e){try{e?.()}catch{}})}}const q=c.findByProps("getBotLabel");function z(){return g.after("default",q,function(t,r){let[{text:e,textColor:s,backgroundColor:o}]=t;try{const n=C.findInReactTree(r,function(l){return typeof l?.props?.children=="string"});n?.props&&(e&&(n.props.children=e),s&&(n.props.style||(n.props.style=[]),Array.isArray(n.props.style)?n.props.style.push({color:s}):n.props.style=[n.props.style,{color:s}])),o&&r?.props&&(r.props.style||(r.props.style=[]),Array.isArray(r.props.style)?r.props.style.push({backgroundColor:o}):r.props.style=[r.props.style,{backgroundColor:o}])}catch(n){console.error("Staff Tags - Tag patch error:",n)}})}const{ScrollView:J}=R.General,{FormSection:Q,FormSwitchRow:Z}=R.Forms;function ee(){return D.useProxy(h.storage),React.createElement(J,{style:{flex:1}},React.createElement(Q,{title:"Tag style"},React.createElement(Z,{label:"Use top role color for tag backgrounds",value:h.storage.useRoleColor,onValueChange:function(t){h.storage.useRoleColor=t}})))}let y=[];var re={onLoad:function(){try{h.storage.useRoleColor??=!1,y.push(H()),y.push(z()),y.push(F()),y.push(X()),y.push(K()),console.log("Staff Tags loaded successfully")}catch(t){throw console.error("Staff Tags - Load error:",t),t}},onUnload:function(){try{y.forEach(function(t){try{t?.()}catch(r){console.error("Staff Tags - Unpatch error:",r)}}),y=[],console.log("Staff Tags unloaded successfully")}catch(t){console.error("Staff Tags - Unload error:",t)}},settings:ee};return E.default=re,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
