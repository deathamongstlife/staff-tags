(function(S,y,l,f,g,d,h,w,A){"use strict";const{Permissions:b}=f.constants,k=l.findByProps("computePermissions","canEveryoneRole"),N=k?.computePermissions,O=l.findByStoreName("GuildMemberStore"),E=[f.i18n?.Messages?.AI_TAG,f.i18n?.Messages?.BOT_TAG_SERVER,f.i18n?.Messages?.SYSTEM_DM_TAG_SYSTEM,f.i18n?.Messages?.GUILD_AUTOMOD_USER_BADGE_TEXT,f.i18n?.Messages?.REMIXING_TAG].filter(Boolean),L=[{text:"WEBHOOK",condition:function(t,e,r){return r?.isNonUserBot?.()}},{text:"OWNER",backgroundColor:d.rawColors.ORANGE_345,condition:function(t,e,r){return t?.ownerId===r?.id}},{text:f.i18n?.Messages?.BOT_TAG_BOT||"BOT",condition:function(t,e,r){return r?.bot},verified:function(t,e,r){return r?.isVerifiedBot?.()}},{text:"ADMIN",backgroundColor:d.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:d.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:d.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function C(t,e,r){try{if(!r)return null;let a;if(t&&N&&b)try{const o=N({user:r,context:t,overwrites:e?.permissionOverwrites});a=Object.entries(b).map(function(n){let[c,s]=n;return o&s?c:""}).filter(Boolean)}catch(o){console.error("Staff Tags - Permission computation error:",o),a=[]}for(const o of L)try{const n=o.condition?.(t,e,r),c=o.permissions?.some(function(s){return a?.includes(s)});if(n||c){let s;if(y.storage.useRoleColor&&t?.id&&r?.id)try{s=O?.getMember?.(t.id,r.id)?.colorString}catch(T){console.error("Staff Tags - Role color error:",T)}let u=s||o.backgroundColor||d.rawColors.BRAND_500,i;try{i=s||!o.textColor?f.chroma(u).get("lab.l")<70?d.rawColors.WHITE_500:d.rawColors.BLACK_500:o.textColor}catch{i=d.rawColors.WHITE_500}return{...o,textColor:i,backgroundColor:u,verified:typeof o.verified=="function"?o.verified(t,e,r):o.verified??!1,condition:void 0,permissions:void 0}}}catch(n){console.error("Staff Tags - Tag processing error:",n);continue}return null}catch(a){return console.error("Staff Tags - getTag error:",a),null}}const x=l.findByName("getTagProperties",!1),D=l.findByStoreName("GuildStore"),P=l.findByStoreName("ChannelStore");function U(){return x?g.after("default",x,function(t,e){let[{message:r}]=t;try{if(!e||!r||E.includes(e.tagText))return e;const a=P?.getChannel?.(r.channel_id),o=D?.getGuild?.(a?.guild_id),n=C(o,a,r.author);if(n)return{...e,tagText:n.text,tagTextColor:n.textColor?f.ReactNative.processColor(f.chroma(n.textColor).hex()):void 0,tagBackgroundColor:n.backgroundColor?f.ReactNative.processColor(f.chroma(n.backgroundColor).hex()):void 0,tagVerified:n.verified,tagType:void 0}}catch(a){console.error("Staff Tags - Chat patch error:",a)}return e}):(console.error("Staff Tags - getTagProperties not found"),function(){})}const B=l.findByProps("getBotLabel"),v=B?.getBotLabel,$=l.findByStoreName("GuildStore"),H=function(t,e){let[{guildId:r,user:a}]=t;try{if(!e?.props?.label||!v)return e;const o=h.findInReactTree(e.props.label,function(c){return c?.type?.Types}),n=o?v(o.props?.type):null;if(!o||!E.includes(n)){const c=$?.getGuild?.(r),s=C(c,void 0,a);if(s&&B?.default)if(o)o.props={type:0,...s};else{const u=h.findInReactTree(e.props.label,function(i){return i?.props?.lineClamp});if(u?.props?.children?.props?.children){const i=u.props.children.props.children;Array.isArray(i)&&i.length>1&&(i[1]=React.createElement(React.Fragment,null," ",React.createElement(B.default,{type:0,text:s.text,textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified})))}}}}catch(o){console.error("Staff Tags - Details patch error:",o)}return e};function F(){const t=[];try{const e=l.findByTypeNameAll("UserRow");e?.length>0&&e.forEach(function(r){r?.type&&t.push(g.after("type",r,H))})}catch(e){console.error("Staff Tags - Failed to patch UserRow:",e)}return function(){t.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Unpatch error:",r)}})}}const _=l.findByName("DisplayName",!1),G=l.findByName("HeaderName",!1),R=l.findByProps("getBotLabel"),M=R?.getBotLabel,K=l.findByStoreName("GuildStore"),V=l.findByStoreName("ChannelStore");function W(){const t=[];return G&&t.push(g.after("default",G,function(e,r){let[{channelId:a}]=e;try{r?.props&&(r.props.channelId=a)}catch(o){console.error("Staff Tags - HeaderName patch error:",o)}})),_&&t.push(g.after("default",_,function(e,r){let[{guildId:a,channelId:o,user:n}]=e;try{if(!r||!M)return;const c=h.findInReactTree(r,function(s){return s?.type?.Types});if(!c||!E.includes(M(c.props?.type))){const s=K?.getGuild?.(a),u=V?.getChannel?.(o),i=C(s,u,n);if(i&&R?.default)if(c)c.props={type:0,...i};else{const T=h.findInReactTree(r,function(re){return re?.props?.style?.flexDirection==="row"});T?.props?.children&&Array.isArray(T.props.children)&&T.props.children.push(React.createElement(R.default,{style:{marginLeft:0},type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}}catch(c){console.error("Staff Tags - DisplayName patch error:",c)}})),function(){return t.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Name unpatch error:",r)}})}}const I=l.findByProps("GuildMemberRow"),m=l.findByProps("getBotLabel"),j=l.findByStoreName("GuildStore");function X(){const t=[];return I?.GuildMemberRow&&t.push(g.after("type",I.GuildMemberRow,function(e,r){let[{guildId:a,channel:o,user:n}]=e;try{if(!r||!n)return r;const c=j?.getGuild?.(a),s=C(c,o,n);if(s&&m?.default&&r.props?.children){const u=React.createElement(m.default,{type:0,text:s.text+"[SIDEBAR]",textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified});Array.isArray(r.props.children)?r.props.children.push(u):r.props.children=[r.props.children,u]}}catch{}return r})),function(){t.forEach(function(e){try{e?.()}catch{}})}}const Y=l.findByProps("getBotLabel");function q(){return g.after("default",Y,function(t,e){let[{text:r,textColor:a,backgroundColor:o}]=t;try{const n=h.findInReactTree(e,function(c){return typeof c?.props?.children=="string"});n?.props&&(r&&(n.props.children=r),a&&(n.props.style||(n.props.style=[]),Array.isArray(n.props.style)?n.props.style.push({color:a}):n.props.style=[n.props.style,{color:a}])),o&&e?.props&&(e.props.style||(e.props.style=[]),Array.isArray(e.props.style)?e.props.style.push({backgroundColor:o}):e.props.style=[e.props.style,{backgroundColor:o}])}catch(n){console.error("Staff Tags - Tag patch error:",n)}})}const{ScrollView:z}=A.General,{FormSection:J,FormSwitchRow:Q}=A.Forms;function Z(){return w.useProxy(y.storage),React.createElement(z,{style:{flex:1}},React.createElement(J,{title:"Tag style"},React.createElement(Q,{label:"Use top role color for tag backgrounds",value:y.storage.useRoleColor,onValueChange:function(t){y.storage.useRoleColor=t}})))}let p=[];var ee={onLoad:function(){try{y.storage.useRoleColor??=!1,p.push(U()),p.push(q()),p.push(W()),p.push(X()),p.push(F()),console.log("Staff Tags loaded successfully")}catch(t){throw console.error("Staff Tags - Load error:",t),t}},onUnload:function(){try{p.forEach(function(t){try{t?.()}catch(e){console.error("Staff Tags - Unpatch error:",e)}}),p=[],console.log("Staff Tags unloaded successfully")}catch(t){console.error("Staff Tags - Unload error:",t)}},settings:Z};return S.default=ee,Object.defineProperty(S,"__esModule",{value:!0}),S})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
