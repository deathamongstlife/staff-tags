(function(x,b,i,u,C,g,d,D,_){"use strict";const{Permissions:G}=u.constants,$=i.findByProps("computePermissions","canEveryoneRole"),w=$?.computePermissions,V=i.findByStoreName("GuildMemberStore"),R=[u.i18n?.Messages?.AI_TAG,u.i18n?.Messages?.BOT_TAG_SERVER,u.i18n?.Messages?.SYSTEM_DM_TAG_SYSTEM,u.i18n?.Messages?.GUILD_AUTOMOD_USER_BADGE_TEXT,u.i18n?.Messages?.REMIXING_TAG].filter(Boolean),H=[{text:"WEBHOOK",condition:function(o,e,r){return r?.isNonUserBot?.()}},{text:"OWNER",backgroundColor:g.rawColors.ORANGE_345,condition:function(o,e,r){return o?.ownerId===r?.id}},{text:u.i18n?.Messages?.BOT_TAG_BOT||"BOT",condition:function(o,e,r){return r?.bot},verified:function(o,e,r){return r?.isVerifiedBot?.()}},{text:"ADMIN",backgroundColor:g.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:g.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:g.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function S(o,e,r){try{if(!r)return null;let t;if(o&&w&&G)try{const n=w({user:r,context:o,overwrites:e?.permissionOverwrites});t=Object.entries(G).map(function(a){let[c,s]=a;return n&s?c:""}).filter(Boolean)}catch(n){console.error("Staff Tags - Permission computation error:",n),t=[]}for(const n of H)try{const a=n.condition?.(o,e,r),c=n.permissions?.some(function(s){return t?.includes(s)});if(a||c){let s;if(b.storage.useRoleColor&&o?.id&&r?.id)try{s=V?.getMember?.(o.id,r.id)?.colorString}catch(T){console.error("Staff Tags - Role color error:",T)}let p=s||n.backgroundColor||g.rawColors.BRAND_500,l;try{l=s||!n.textColor?u.chroma(p).get("lab.l")<70?g.rawColors.WHITE_500:g.rawColors.BLACK_500:n.textColor}catch{l=g.rawColors.WHITE_500}return{...n,textColor:l,backgroundColor:p,verified:typeof n.verified=="function"?n.verified(o,e,r):n.verified??!1,condition:void 0,permissions:void 0}}}catch(a){console.error("Staff Tags - Tag processing error:",a);continue}return null}catch(t){return console.error("Staff Tags - getTag error:",t),null}}const k=i.findByName("getTagProperties",!1),F=i.findByStoreName("GuildStore"),K=i.findByStoreName("ChannelStore");function W(){return k?C.after("default",k,function(o,e){let[{message:r}]=o;try{if(!e||!r||R.includes(e.tagText))return e;const t=K?.getChannel?.(r.channel_id),n=F?.getGuild?.(t?.guild_id),a=S(n,t,r.author);if(a)return{...e,tagText:a.text,tagTextColor:a.textColor?u.ReactNative.processColor(u.chroma(a.textColor).hex()):void 0,tagBackgroundColor:a.backgroundColor?u.ReactNative.processColor(u.chroma(a.backgroundColor).hex()):void 0,tagVerified:a.verified,tagType:void 0}}catch(t){console.error("Staff Tags - Chat patch error:",t)}return e}):(console.error("Staff Tags - getTagProperties not found"),function(){})}const M=i.findByProps("getBotLabel"),L=M?.getBotLabel,j=i.findByStoreName("GuildStore"),X=function(o,e){let[{guildId:r,user:t}]=o;try{if(!e?.props?.label||!L)return e;const n=d.findInReactTree(e.props.label,function(c){return c?.type?.Types}),a=n?L(n.props?.type):null;if(!n||!R.includes(a)){const c=j?.getGuild?.(r),s=S(c,void 0,t);if(s&&M?.default)if(n)n.props={type:0,...s};else{const p=d.findInReactTree(e.props.label,function(l){return l?.props?.lineClamp});if(p?.props?.children?.props?.children){const l=p.props.children.props.children;Array.isArray(l)&&l.length>1&&(l[1]=React.createElement(React.Fragment,null," ",React.createElement(M.default,{type:0,text:s.text,textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified})))}}}}catch(n){console.error("Staff Tags - Details patch error:",n)}return e};function Y(){const o=[];try{const e=i.findByTypeNameAll("UserRow");e?.length>0&&e.forEach(function(r){r?.type&&o.push(C.after("type",r,X))})}catch(e){console.error("Staff Tags - Failed to patch UserRow:",e)}return function(){o.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Unpatch error:",r)}})}}const U=i.findByName("DisplayName",!1),O=i.findByName("HeaderName",!1),v=i.findByProps("getBotLabel"),P=v?.getBotLabel,q=i.findByStoreName("GuildStore"),z=i.findByStoreName("ChannelStore");function J(){const o=[];return O&&o.push(C.after("default",O,function(e,r){let[{channelId:t}]=e;try{r?.props&&(r.props.channelId=t)}catch(n){console.error("Staff Tags - HeaderName patch error:",n)}})),U&&o.push(C.after("default",U,function(e,r){let[{guildId:t,channelId:n,user:a}]=e;try{if(!r||!P)return;const c=d.findInReactTree(r,function(s){return s?.type?.Types});if(!c||!R.includes(P(c.props?.type))){const s=q?.getGuild?.(t),p=z?.getChannel?.(n),l=S(s,p,a);if(l&&v?.default)if(c)c.props={type:0,...l};else{const T=d.findInReactTree(r,function(E){return E?.props?.style?.flexDirection==="row"});T?.props?.children&&Array.isArray(T.props.children)&&T.props.children.push(React.createElement(v.default,{style:{marginLeft:0},type:0,text:l.text,textColor:l.textColor,backgroundColor:l.backgroundColor,verified:l.verified}))}}}catch(c){console.error("Staff Tags - DisplayName patch error:",c)}})),function(){return o.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Name unpatch error:",r)}})}}const A=i.findByProps("getBotLabel"),Q=A?.getBotLabel,Z=i.findByStoreName("GuildStore");function ee(){const o=[],e=[i.findByProps("GuildMemberRow"),i.findByProps("MemberListItem"),i.findByProps("MemberRow"),i.findByProps("UserRow"),{MemberListItem:i.findByName("MemberListItem",!1)},{VoiceUser:i.findByName("VoiceUser",!1)},{ConnectedMember:i.findByName("ConnectedMember",!1)},{Member:i.findByName("Member",!1)},...i.findByTypeNameAll("GuildMemberRow").map(function(t){return{GuildMemberRow:t}}),...i.findByTypeNameAll("MemberListItem").map(function(t){return{MemberListItem:t}}),...i.findByTypeNameAll("MemberRow").map(function(t){return{MemberRow:t}}),...i.findByTypeNameAll("UserRow").map(function(t){return{UserRow:t}}),...i.findByTypeNameAll("VoiceUser").map(function(t){return{VoiceUser:t}})].filter(Boolean),r=function(t,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"type";t&&o.push(C.after(a,t,function(c,s){let[p]=c;try{const{guildId:l,channel:T,user:E}=p||{};if(!s||!E)return s;const ce=Z?.getGuild?.(l),I=S(ce,T,E);if(I&&A?.default){const y={...I,text:I.text+`[${n}]`},m=d.findInReactTree(s,function(N){return N?.type?.Types});if(!m||!R.includes(Q?.(m.props?.type)))if(m)m.props={type:0,...y};else{const N=[function(){return s?.props?.children&&Array.isArray(s.props.children)?s:null},function(){return d.findInReactTree(s,function(f){return f?.props?.style?.flexDirection==="row"})},function(){return d.findInReactTree(s,function(f){return f?.props?.style?.display==="flex"})},function(){return d.findInReactTree(s,function(f){return Array.isArray(f?.props?.children)&&f.props.children.length>0})},function(){return d.findInReactTree(s,function(f){return f?.type?.name==="View"&&f.props?.children})},function(){return d.findInReactTree(s,function(f){return f?.props?.children})}];for(let f=0;f<N.length;f++){const B=N[f]();if(B?.props?.children)if(Array.isArray(B.props.children)){B.props.children.push(React.createElement(A.default,{type:0,text:y.text,textColor:y.textColor,backgroundColor:y.backgroundColor,verified:y.verified}));break}else{B.props.children=[B.props.children,React.createElement(A.default,{type:0,text:y.text,textColor:y.textColor,backgroundColor:y.backgroundColor,verified:y.verified})];break}}}}}catch{}return s}))};return e.forEach(function(t){typeof t=="object"&&Object.entries(t).forEach(function(n){let[a,c]=n;c&&(r(c,a,"type"),r(c,a+"_default","default"))})}),function(){o.forEach(function(t){try{t?.()}catch{}})}}const re=i.findByProps("getBotLabel");function te(){return C.after("default",re,function(o,e){let[{text:r,textColor:t,backgroundColor:n}]=o;try{const a=d.findInReactTree(e,function(c){return typeof c?.props?.children=="string"});a?.props&&(r&&(a.props.children=r),t&&(a.props.style||(a.props.style=[]),Array.isArray(a.props.style)?a.props.style.push({color:t}):a.props.style=[a.props.style,{color:t}])),n&&e?.props&&(e.props.style||(e.props.style=[]),Array.isArray(e.props.style)?e.props.style.push({backgroundColor:n}):e.props.style=[e.props.style,{backgroundColor:n}])}catch(a){console.error("Staff Tags - Tag patch error:",a)}})}const{ScrollView:oe}=_.General,{FormSection:ne,FormSwitchRow:ae}=_.Forms;function se(){return D.useProxy(b.storage),React.createElement(oe,{style:{flex:1}},React.createElement(ne,{title:"Tag style"},React.createElement(ae,{label:"Use top role color for tag backgrounds",value:b.storage.useRoleColor,onValueChange:function(o){b.storage.useRoleColor=o}})))}let h=[];var ie={onLoad:function(){try{b.storage.useRoleColor??=!1,h.push(W()),h.push(te()),h.push(J()),h.push(ee()),h.push(Y()),console.log("Staff Tags loaded successfully")}catch(o){throw console.error("Staff Tags - Load error:",o),o}},onUnload:function(){try{h.forEach(function(o){try{o?.()}catch(e){console.error("Staff Tags - Unpatch error:",e)}}),h=[],console.log("Staff Tags unloaded successfully")}catch(o){console.error("Staff Tags - Unload error:",o)}},settings:se};return x.default=ie,Object.defineProperty(x,"__esModule",{value:!0}),x})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
