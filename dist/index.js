(function(E,y,l,c,d,u,T,x,D){"use strict";const{Permissions:A}=c.constants,L=l.findByProps("computePermissions","canEveryoneRole"),R=L?.computePermissions,O=l.findByStoreName("GuildMemberStore"),v=[c.i18n?.Messages?.AI_TAG,c.i18n?.Messages?.BOT_TAG_SERVER,c.i18n?.Messages?.SYSTEM_DM_TAG_SYSTEM,c.i18n?.Messages?.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n?.Messages?.REMIXING_TAG].filter(Boolean),P=[{text:"WEBHOOK",condition:function(r,t,e){return e?.isNonUserBot?.()}},{text:"OWNER",backgroundColor:u.rawColors.ORANGE_345,condition:function(r,t,e){return r?.ownerId===e?.id}},{text:c.i18n?.Messages?.BOT_TAG_BOT||"BOT",condition:function(r,t,e){return e?.bot},verified:function(r,t,e){return e?.isVerifiedBot?.()}},{text:"ADMIN",backgroundColor:u.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:u.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:u.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function h(r,t,e){try{if(!e)return null;let a;if(r&&R&&A)try{const n=R({user:e,context:r,overwrites:t?.permissionOverwrites});a=Object.entries(A).map(function(o){let[i,s]=o;return n&s?i:""}).filter(Boolean)}catch(n){console.error("Staff Tags - Permission computation error:",n),a=[]}for(const n of P)try{const o=n.condition?.(r,t,e),i=n.permissions?.some(function(s){return a?.includes(s)});if(o||i){let s;if(y.storage.useRoleColor&&r?.id&&e?.id)try{s=O?.getMember?.(r.id,e.id)?.colorString}catch(C){console.error("Staff Tags - Role color error:",C)}let g=s||n.backgroundColor||u.rawColors.BRAND_500,f;try{f=s||!n.textColor?c.chroma(g).get("lab.l")<70?u.rawColors.WHITE_500:u.rawColors.BLACK_500:n.textColor}catch{f=u.rawColors.WHITE_500}return{...n,textColor:f,backgroundColor:g,verified:typeof n.verified=="function"?n.verified(r,t,e):n.verified??!1,condition:void 0,permissions:void 0}}}catch(o){console.error("Staff Tags - Tag processing error:",o);continue}return null}catch(a){return console.error("Staff Tags - getTag error:",a),null}}const _=l.findByName("getTagProperties",!1),U=l.findByStoreName("GuildStore"),$=l.findByStoreName("ChannelStore");function V(){return _?d.after("default",_,function(r,t){let[{message:e}]=r;try{if(!t||!e||v.includes(t.tagText))return t;const a=$?.getChannel?.(e.channel_id),n=U?.getGuild?.(a?.guild_id),o=h(n,a,e.author);if(o)return{...t,tagText:o.text,tagTextColor:o.textColor?c.ReactNative.processColor(c.chroma(o.textColor).hex()):void 0,tagBackgroundColor:o.backgroundColor?c.ReactNative.processColor(c.chroma(o.backgroundColor).hex()):void 0,tagVerified:o.verified,tagType:void 0}}catch(a){console.error("Staff Tags - Chat patch error:",a)}return t}):(console.error("Staff Tags - getTagProperties not found"),function(){})}const S=l.findByProps("getBotLabel"),G=l.findByStoreName("GuildStore"),I=l.findByName("DefaultName",!1),M=l.findByName("DisplayName",!1);function H(){const r=[];return I&&r.push(d.after("default",I,function(t,e){let[a]=t;try{const n=a?.user,o=a?.guildId;if(!n||!e)return e;const i=G?.getGuild?.(o),s=h(i,null,n);s&&S?.default&&e.props?.children[0]?.props?.children?.push(React.createElement(S.default,{type:0,text:s.text+"[DEFAULT]",textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified}))}catch{}return e})),M&&r.push(d.after("default",M,function(t,e){let[a]=t;try{const n=a?.user,o=a?.guildId;if(!n||!e)return e;const i=G?.getGuild?.(o),s=h(i,null,n);s&&S?.default&&e.props?.children?.props?.children[0]?.props?.children?.push(React.createElement(S.default,{type:0,text:s.text+"[DISPLAY]",textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified}))}catch{}return e})),function(){r.forEach(function(t){try{t?.()}catch{}})}}const m=l.findByName("DisplayName",!1),k=l.findByName("HeaderName",!1),B=l.findByProps("getBotLabel"),w=B?.getBotLabel,K=l.findByStoreName("GuildStore"),W=l.findByStoreName("ChannelStore");function F(){const r=[];return k&&r.push(d.after("default",k,function(t,e){let[{channelId:a}]=t;try{e?.props&&(e.props.channelId=a)}catch(n){console.error("Staff Tags - HeaderName patch error:",n)}})),m&&r.push(d.after("default",m,function(t,e){let[{guildId:a,channelId:n,user:o}]=t;try{if(!e||!w)return;const i=T.findInReactTree(e,function(s){return s?.type?.Types});if(!i||!v.includes(w(i.props?.type))){const s=K?.getGuild?.(a),g=W?.getChannel?.(n),f=h(s,g,o);if(f&&B?.default)if(i)i.props={type:0,...f};else{const C=T.findInReactTree(e,function(te){return te?.props?.style?.flexDirection==="row"});C?.props?.children&&Array.isArray(C.props.children)&&C.props.children.push(React.createElement(B.default,{style:{marginLeft:0},type:0,text:f.text,textColor:f.textColor,backgroundColor:f.backgroundColor,verified:f.verified}))}}}catch(i){console.error("Staff Tags - DisplayName patch error:",i)}})),function(){return r.forEach(function(t){try{t?.()}catch(e){console.error("Staff Tags - Name unpatch error:",e)}})}}const{View:N}=x.General,b=l.findByProps("getBotLabel");b?.getBotLabel;const j=l.findByStoreName("GuildStore");function Y(){const r=[],t=function(e,a){let[{user:n,guildId:o}]=e;try{if(!a||!n||!o)return a;const i=j?.getGuild?.(o),s=h(i,null,n);s&&b?.default&&(T.findInReactTree(a?.props?.label,function(g){return g.key=="StaffTagsView"})||(a.props.label=React.createElement(N,{style:{justifyContent:"space-between",flexDirection:"row",alignItems:"center",flex:1},key:"StaffTagsView"},React.createElement(N,{style:{flexDirection:"row",alignItems:"center",flex:1}},a.props.label,React.createElement(N,{key:"StaffTagsMemberList",style:{flexDirection:"row",marginLeft:4}},React.createElement(b.default,{type:0,text:s.text,textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified}))))))}catch{}return a};return l.findByTypeNameAll("UserRow").forEach(function(e){return r.push(d.after("type",e,t))}),function(){r.forEach(function(e){try{e?.()}catch{}})}}const X=l.findByProps("getBotLabel");function q(){return d.after("default",X,function(r,t){let[{text:e,textColor:a,backgroundColor:n}]=r;try{const o=T.findInReactTree(t,function(i){return typeof i?.props?.children=="string"});o?.props&&(e&&(o.props.children=e),a&&(o.props.style||(o.props.style=[]),Array.isArray(o.props.style)?o.props.style.push({color:a}):o.props.style=[o.props.style,{color:a}])),n&&t?.props&&(t.props.style||(t.props.style=[]),Array.isArray(t.props.style)?t.props.style.push({backgroundColor:n}):t.props.style=[t.props.style,{backgroundColor:n}])}catch(o){console.error("Staff Tags - Tag patch error:",o)}})}const{ScrollView:z}=x.General,{FormSection:J,FormSwitchRow:Q}=x.Forms;function Z(){return D.useProxy(y.storage),React.createElement(z,{style:{flex:1}},React.createElement(J,{title:"Tag style"},React.createElement(Q,{label:"Use top role color for tag backgrounds",value:y.storage.useRoleColor,onValueChange:function(r){y.storage.useRoleColor=r}})))}let p=[];var ee={onLoad:function(){try{y.storage.useRoleColor??=!1,p.push(V()),p.push(q()),p.push(F()),p.push(Y()),p.push(H()),console.log("Staff Tags loaded successfully")}catch(r){throw console.error("Staff Tags - Load error:",r),r}},onUnload:function(){try{p.forEach(function(r){try{r?.()}catch(t){console.error("Staff Tags - Unpatch error:",t)}}),p=[],console.log("Staff Tags unloaded successfully")}catch(r){console.error("Staff Tags - Unload error:",r)}},settings:Z};return E.default=ee,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.ui.components,vendetta.storage);
