(function(B,h,a,c,y,d,C,k,A){"use strict";const{Permissions:x}=c.constants,O=a.findByProps("computePermissions","canEveryoneRole"),_=O?.computePermissions,w=a.findByStoreName("GuildMemberStore"),R=[c.i18n?.Messages?.AI_TAG,c.i18n?.Messages?.BOT_TAG_SERVER,c.i18n?.Messages?.SYSTEM_DM_TAG_SYSTEM,c.i18n?.Messages?.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n?.Messages?.REMIXING_TAG].filter(Boolean),P=[{text:"WEBHOOK",condition:function(o,e,r){return r?.isNonUserBot?.()}},{text:"OWNER",backgroundColor:d.rawColors.ORANGE_345,condition:function(o,e,r){return o?.ownerId===r?.id}},{text:c.i18n?.Messages?.BOT_TAG_BOT||"BOT",condition:function(o,e,r){return r?.bot},verified:function(o,e,r){return r?.isVerifiedBot?.()}},{text:"ADMIN",backgroundColor:d.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:d.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:d.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function S(o,e,r){try{if(!r)return null;let s;if(o&&_&&x)try{const n=_({user:r,context:o,overwrites:e?.permissionOverwrites});s=Object.entries(x).map(function(t){let[i,l]=t;return n&l?i:""}).filter(Boolean)}catch(n){console.error("Staff Tags - Permission computation error:",n),s=[]}for(const n of P)try{const t=n.condition?.(o,e,r),i=n.permissions?.some(function(l){return s?.includes(l)});if(t||i){let l;if(h.storage.useRoleColor&&o?.id&&r?.id)try{l=w?.getMember?.(o.id,r.id)?.colorString}catch(u){console.error("Staff Tags - Role color error:",u)}let g=l||n.backgroundColor||d.rawColors.BRAND_500,f;try{f=l||!n.textColor?c.chroma(g).get("lab.l")<70?d.rawColors.WHITE_500:d.rawColors.BLACK_500:n.textColor}catch{f=d.rawColors.WHITE_500}return{...n,textColor:f,backgroundColor:g,verified:typeof n.verified=="function"?n.verified(o,e,r):n.verified??!1,condition:void 0,permissions:void 0}}}catch(t){console.error("Staff Tags - Tag processing error:",t);continue}return null}catch(s){return console.error("Staff Tags - getTag error:",s),null}}const v=a.findByName("getTagProperties",!1),L=a.findByStoreName("GuildStore"),U=a.findByStoreName("ChannelStore");function $(){return v?y.after("default",v,function(o,e){let[{message:r}]=o;try{if(!e||!r||R.includes(e.tagText))return e;const s=U?.getChannel?.(r.channel_id),n=L?.getGuild?.(s?.guild_id),t=S(n,s,r.author);if(t)return{...e,tagText:t.text,tagTextColor:t.textColor?c.ReactNative.processColor(c.chroma(t.textColor).hex()):void 0,tagBackgroundColor:t.backgroundColor?c.ReactNative.processColor(c.chroma(t.backgroundColor).hex()):void 0,tagVerified:t.verified,tagType:void 0}}catch(s){console.error("Staff Tags - Chat patch error:",s)}return e}):(console.error("Staff Tags - getTagProperties not found"),function(){})}const E=a.findByProps("getBotLabel");E?.getBotLabel;const D=a.findByStoreName("GuildStore"),H=a.findByName("UserProfileModal",!1),K=a.findByName("UserProfile",!1),V=a.findByName("ProfileModal",!1);function W(){const o=[],e=function(r,s){r&&o.push(y.after("default",r,function(n,t){let[i]=n;try{const{guildId:l,user:g}=i||{};if(!t||!g)return t;const f=D?.getGuild?.(l),u=S(f,void 0,g);if(u&&E?.default){const T=C.findInReactTree(t,function(m){return m?.props?.children&&Array.isArray(m.props.children)});T?.props?.children&&T.props.children.push(React.createElement(E.default,{type:0,text:u.text+`[${s}]`,textColor:u.textColor,backgroundColor:u.backgroundColor,verified:u.verified}))}}catch{}return t}))};return e(H,"ProfileModal"),e(K,"UserProfile"),e(V,"Modal"),function(){o.forEach(function(r){try{r?.()}catch{}})}}const M=a.findByName("DisplayName",!1),b=a.findByName("HeaderName",!1),N=a.findByProps("getBotLabel"),G=N?.getBotLabel,F=a.findByStoreName("GuildStore"),j=a.findByStoreName("ChannelStore");function X(){const o=[];return b&&o.push(y.after("default",b,function(e,r){let[{channelId:s}]=e;try{r?.props&&(r.props.channelId=s)}catch(n){console.error("Staff Tags - HeaderName patch error:",n)}})),M&&o.push(y.after("default",M,function(e,r){let[{guildId:s,channelId:n,user:t}]=e;try{if(!r||!G)return;const i=C.findInReactTree(r,function(l){return l?.type?.Types});if(!i||!R.includes(G(i.props?.type))){const l=F?.getGuild?.(s),g=j?.getChannel?.(n),f=S(l,g,t);if(f&&N?.default)if(i)i.props={type:0,...f};else{const u=C.findInReactTree(r,function(T){return T?.props?.style?.flexDirection==="row"});u?.props?.children&&Array.isArray(u.props.children)&&u.props.children.push(React.createElement(N.default,{style:{marginLeft:0},type:0,text:f.text,textColor:f.textColor,backgroundColor:f.backgroundColor,verified:f.verified}))}}}catch(i){console.error("Staff Tags - DisplayName patch error:",i)}})),function(){return o.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Name unpatch error:",r)}})}}const I=a.findByName("RowManager"),Y=a.findByStoreName("GuildStore");function q(){return I?y.before("generate",I.prototype,function(o){let[e]=o;try{if(e?.message?.author||e?.user){const r=e.message?.author||e.user,s=e.guildId||e.message?.guild_id;if(r&&s){const n=Y?.getGuild?.(s),t=S(n,null,r);t&&(e.text&&(e.text=e.text+` ${t.text}`),t.backgroundColor&&e.roleStyle!==void 0&&(e.roleStyle=t.backgroundColor))}}}catch{}}):function(){}}const z=a.findByProps("getBotLabel");function J(){return y.after("default",z,function(o,e){let[{text:r,textColor:s,backgroundColor:n}]=o;try{const t=C.findInReactTree(e,function(i){return typeof i?.props?.children=="string"});t?.props&&(r&&(t.props.children=r),s&&(t.props.style||(t.props.style=[]),Array.isArray(t.props.style)?t.props.style.push({color:s}):t.props.style=[t.props.style,{color:s}])),n&&e?.props&&(e.props.style||(e.props.style=[]),Array.isArray(e.props.style)?e.props.style.push({backgroundColor:n}):e.props.style=[e.props.style,{backgroundColor:n}])}catch(t){console.error("Staff Tags - Tag patch error:",t)}})}const{ScrollView:Q}=A.General,{FormSection:Z,FormSwitchRow:ee}=A.Forms;function re(){return k.useProxy(h.storage),React.createElement(Q,{style:{flex:1}},React.createElement(Z,{title:"Tag style"},React.createElement(ee,{label:"Use top role color for tag backgrounds",value:h.storage.useRoleColor,onValueChange:function(o){h.storage.useRoleColor=o}})))}let p=[];var te={onLoad:function(){try{h.storage.useRoleColor??=!1,p.push($()),p.push(J()),p.push(X()),p.push(q()),p.push(W()),console.log("Staff Tags loaded successfully")}catch(o){throw console.error("Staff Tags - Load error:",o),o}},onUnload:function(){try{p.forEach(function(o){try{o?.()}catch(e){console.error("Staff Tags - Unpatch error:",e)}}),p=[],console.log("Staff Tags unloaded successfully")}catch(o){console.error("Staff Tags - Unload error:",o)}},settings:re};return B.default=te,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
