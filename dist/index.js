(function(A,T,l,u,p,g,y,$,v){"use strict";const{Permissions:_}=u.constants,H=l.findByProps("computePermissions","canEveryoneRole"),G=H?.computePermissions,V=l.findByStoreName("GuildMemberStore"),C=[u.i18n?.Messages?.AI_TAG,u.i18n?.Messages?.BOT_TAG_SERVER,u.i18n?.Messages?.SYSTEM_DM_TAG_SYSTEM,u.i18n?.Messages?.GUILD_AUTOMOD_USER_BADGE_TEXT,u.i18n?.Messages?.REMIXING_TAG].filter(Boolean),F=[{text:"WEBHOOK",condition:function(t,e,r){return r?.isNonUserBot?.()}},{text:"OWNER",backgroundColor:g.rawColors.ORANGE_345,condition:function(t,e,r){return t?.ownerId===r?.id}},{text:u.i18n?.Messages?.BOT_TAG_BOT||"BOT",condition:function(t,e,r){return r?.bot},verified:function(t,e,r){return r?.isVerifiedBot?.()}},{text:"ADMIN",backgroundColor:g.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:g.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:g.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function S(t,e,r){try{if(!r)return null;let s;if(t&&G&&_)try{const o=G({user:r,context:t,overwrites:e?.permissionOverwrites});s=Object.entries(_).map(function(n){let[i,a]=n;return o&a?i:""}).filter(Boolean)}catch(o){console.error("Staff Tags - Permission computation error:",o),s=[]}for(const o of F)try{const n=o.condition?.(t,e,r),i=o.permissions?.some(function(a){return s?.includes(a)});if(n||i){let a;if(T.storage.useRoleColor&&t?.id&&r?.id)try{a=V?.getMember?.(t.id,r.id)?.colorString}catch(f){console.error("Staff Tags - Role color error:",f)}let d=a||o.backgroundColor||g.rawColors.BRAND_500,c;try{c=a||!o.textColor?u.chroma(d).get("lab.l")<70?g.rawColors.WHITE_500:g.rawColors.BLACK_500:o.textColor}catch{c=g.rawColors.WHITE_500}return{...o,textColor:c,backgroundColor:d,verified:typeof o.verified=="function"?o.verified(t,e,r):o.verified??!1,condition:void 0,permissions:void 0}}}catch(n){console.error("Staff Tags - Tag processing error:",n);continue}return null}catch(s){return console.error("Staff Tags - getTag error:",s),null}}const M=l.findByName("getTagProperties",!1),K=l.findByStoreName("GuildStore"),W=l.findByStoreName("ChannelStore");function j(){return M?p.after("default",M,function(t,e){let[{message:r}]=t;try{if(!e||!r||C.includes(e.tagText))return e;const s=W?.getChannel?.(r.channel_id),o=K?.getGuild?.(s?.guild_id),n=S(o,s,r.author);if(n)return{...e,tagText:n.text,tagTextColor:n.textColor?u.ReactNative.processColor(u.chroma(n.textColor).hex()):void 0,tagBackgroundColor:n.backgroundColor?u.ReactNative.processColor(u.chroma(n.backgroundColor).hex()):void 0,tagVerified:n.verified,tagType:void 0}}catch(s){console.error("Staff Tags - Chat patch error:",s)}return e}):(console.error("Staff Tags - getTagProperties not found"),function(){})}const b=l.findByProps("getBotLabel"),I=b?.getBotLabel,X=l.findByStoreName("GuildStore"),Y=function(t,e){let[{guildId:r,user:s}]=t;try{if(!e?.props?.label||!I)return e;const o=y.findInReactTree(e.props.label,function(i){return i?.type?.Types}),n=o?I(o.props?.type):null;if(!o||!C.includes(n)){const i=X?.getGuild?.(r),a=S(i,void 0,s);if(a&&b?.default)if(o)o.props={type:0,...a};else{const d=y.findInReactTree(e.props.label,function(c){return c?.props?.lineClamp});if(d?.props?.children?.props?.children){const c=d.props.children.props.children;Array.isArray(c)&&c.length>1&&(c[1]=React.createElement(React.Fragment,null," ",React.createElement(b.default,{type:0,text:a.text,textColor:a.textColor,backgroundColor:a.backgroundColor,verified:a.verified})))}}}}catch(o){console.error("Staff Tags - Details patch error:",o)}return e};function q(){const t=[];try{const e=l.findByTypeNameAll("UserRow");e?.length>0&&e.forEach(function(r){r?.type&&t.push(p.after("type",r,Y))})}catch(e){console.error("Staff Tags - Failed to patch UserRow:",e)}return function(){t.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Unpatch error:",r)}})}}const m=l.findByName("DisplayName",!1),k=l.findByName("HeaderName",!1),x=l.findByProps("getBotLabel"),w=x?.getBotLabel,z=l.findByStoreName("GuildStore"),J=l.findByStoreName("ChannelStore");function Q(){const t=[];return k&&t.push(p.after("default",k,function(e,r){let[{channelId:s}]=e;try{r?.props&&(r.props.channelId=s)}catch(o){console.error("Staff Tags - HeaderName patch error:",o)}})),m&&t.push(p.after("default",m,function(e,r){let[{guildId:s,channelId:o,user:n}]=e;try{if(!r||!w)return;const i=y.findInReactTree(r,function(a){return a?.type?.Types});if(!i||!C.includes(w(i.props?.type))){const a=z?.getGuild?.(s),d=J?.getChannel?.(o),c=S(a,d,n);if(c&&x?.default)if(i)i.props={type:0,...c};else{const f=y.findInReactTree(r,function(E){return E?.props?.style?.flexDirection==="row"});f?.props?.children&&Array.isArray(f.props.children)&&f.props.children.push(React.createElement(x.default,{style:{marginLeft:0},type:0,text:c.text,textColor:c.textColor,backgroundColor:c.backgroundColor,verified:c.verified}))}}}catch(i){console.error("Staff Tags - DisplayName patch error:",i)}})),function(){return t.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Name unpatch error:",r)}})}}const B=l.findByProps("getBotLabel"),L=B?.getBotLabel,Z=l.findByStoreName("GuildStore"),O=l.findByProps("GuildMemberRow")?.GuildMemberRow,D=l.findByName("MemberListItem",!1),U=l.findByName("VoiceUser",!1);function ee(){const t=[],e=function(r,s){let[o]=r;try{const{guildId:n,channel:i,user:a}=o||{};if(!s||!L||!a)return s;const d=y.findInReactTree(s,function(c){return c?.type?.Types});if(!d||!C.includes(L(d.props?.type))){const c=Z?.getGuild?.(n),f=S(c,i,a);if(f&&B?.default)if(d)d.props={type:0,...f};else{let E=!1;const N=y.findInReactTree(s,function(R){return R?.props?.style?.flexDirection==="row"});if(N?.props?.children&&Array.isArray(N.props.children)&&(N.props.children.push(React.createElement(B.default,{type:0,text:f.text,textColor:f.textColor,backgroundColor:f.backgroundColor,verified:f.verified})),E=!0),!E){const R=y.findInReactTree(s,function(P){return Array.isArray(P?.props?.children)&&P.props.children.length>0});R?.props?.children&&R.props.children.push(React.createElement(B.default,{type:0,text:f.text,textColor:f.textColor,backgroundColor:f.backgroundColor,verified:f.verified}))}}}}catch{}return s};return O&&t.push(p.after("type",O,e)),D&&t.push(p.after("default",D,e)),U&&t.push(p.after("default",U,e)),function(){t.forEach(function(r){try{r?.()}catch{}})}}const re=l.findByProps("getBotLabel");function te(){return p.after("default",re,function(t,e){let[{text:r,textColor:s,backgroundColor:o}]=t;try{const n=y.findInReactTree(e,function(i){return typeof i?.props?.children=="string"});n?.props&&(r&&(n.props.children=r),s&&(n.props.style||(n.props.style=[]),Array.isArray(n.props.style)?n.props.style.push({color:s}):n.props.style=[n.props.style,{color:s}])),o&&e?.props&&(e.props.style||(e.props.style=[]),Array.isArray(e.props.style)?e.props.style.push({backgroundColor:o}):e.props.style=[e.props.style,{backgroundColor:o}])}catch(n){console.error("Staff Tags - Tag patch error:",n)}})}const{ScrollView:oe}=v.General,{FormSection:ne,FormSwitchRow:se}=v.Forms;function ae(){return $.useProxy(T.storage),React.createElement(oe,{style:{flex:1}},React.createElement(ne,{title:"Tag style"},React.createElement(se,{label:"Use top role color for tag backgrounds",value:T.storage.useRoleColor,onValueChange:function(t){T.storage.useRoleColor=t}})))}let h=[];var ce={onLoad:function(){try{T.storage.useRoleColor??=!1,h.push(j()),h.push(te()),h.push(Q()),h.push(ee()),h.push(q()),console.log("Staff Tags loaded successfully")}catch(t){throw console.error("Staff Tags - Load error:",t),t}},onUnload:function(){try{h.forEach(function(t){try{t?.()}catch(e){console.error("Staff Tags - Unpatch error:",e)}}),h=[],console.log("Staff Tags unloaded successfully")}catch(t){console.error("Staff Tags - Unload error:",t)}},settings:ae};return A.default=ce,Object.defineProperty(A,"__esModule",{value:!0}),A})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
