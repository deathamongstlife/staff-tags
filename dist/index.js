(function(C,y,l,c,p,u,S,E,m){"use strict";const{Permissions:N}=c.constants,w=l.findByProps("computePermissions","canEveryoneRole"),A=w?.computePermissions,k=l.findByStoreName("GuildMemberStore"),R=[c.i18n?.Messages?.AI_TAG,c.i18n?.Messages?.BOT_TAG_SERVER,c.i18n?.Messages?.SYSTEM_DM_TAG_SYSTEM,c.i18n?.Messages?.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n?.Messages?.REMIXING_TAG].filter(Boolean),O=[{text:"WEBHOOK",condition:function(o,e,r){return r?.isNonUserBot?.()}},{text:"OWNER",backgroundColor:u.rawColors.ORANGE_345,condition:function(o,e,r){return o?.ownerId===r?.id}},{text:c.i18n?.Messages?.BOT_TAG_BOT||"BOT",condition:function(o,e,r){return r?.bot},verified:function(o,e,r){return r?.isVerifiedBot?.()}},{text:"ADMIN",backgroundColor:u.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:u.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:u.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function T(o,e,r){try{if(!r)return null;let n;if(o&&A&&N)try{const a=A({user:r,context:o,overwrites:e?.permissionOverwrites});n=Object.entries(N).map(function(t){let[i,s]=t;return a&s?i:""}).filter(Boolean)}catch(a){console.error("Staff Tags - Permission computation error:",a),n=[]}for(const a of O)try{const t=a.condition?.(o,e,r),i=a.permissions?.some(function(s){return n?.includes(s)});if(t||i){let s;if(y.storage.useRoleColor&&o?.id&&r?.id)try{s=k?.getMember?.(o.id,r.id)?.colorString}catch(h){console.error("Staff Tags - Role color error:",h)}let g=s||a.backgroundColor||u.rawColors.BRAND_500,f;try{f=s||!a.textColor?c.chroma(g).get("lab.l")<70?u.rawColors.WHITE_500:u.rawColors.BLACK_500:a.textColor}catch{f=u.rawColors.WHITE_500}return{...a,textColor:f,backgroundColor:g,verified:typeof a.verified=="function"?a.verified(o,e,r):a.verified??!1,condition:void 0,permissions:void 0}}}catch(t){console.error("Staff Tags - Tag processing error:",t);continue}return null}catch(n){return console.error("Staff Tags - getTag error:",n),null}}const b=l.findByName("getTagProperties",!1),L=l.findByStoreName("GuildStore"),D=l.findByStoreName("ChannelStore");function P(){return b?p.after("default",b,function(o,e){let[{message:r}]=o;try{if(!e||!r||R.includes(e.tagText))return e;const n=D?.getChannel?.(r.channel_id),a=L?.getGuild?.(n?.guild_id),t=T(a,n,r.author);if(t)return{...e,tagText:t.text,tagTextColor:t.textColor?c.ReactNative.processColor(c.chroma(t.textColor).hex()):void 0,tagBackgroundColor:t.backgroundColor?c.ReactNative.processColor(c.chroma(t.backgroundColor).hex()):void 0,tagVerified:t.verified,tagType:void 0}}catch(n){console.error("Staff Tags - Chat patch error:",n)}return e}):(console.error("Staff Tags - getTagProperties not found"),function(){})}const{View:_}=E.General,B=l.findByProps("getBotLabel");B?.getBotLabel;const U=l.findByStoreName("GuildStore");function $(){const o=[],e=function(r,n){let[{user:a,guildId:t}]=r;try{if(!n||!a||!t)return n;const i=U?.getGuild?.(t),s=T(i,null,a);s&&B?.default&&(S.findInReactTree(n?.props?.label,function(g){return g.key=="StaffTagsView"})||(n.props.label=React.createElement(_,{style:{justifyContent:"flex-start",flexDirection:"row",alignItems:"center"},key:"StaffTagsView"},n.props.label,React.createElement(_,{key:"StaffTagsMemberList",style:{flexDirection:"row",marginLeft:4}},React.createElement(B.default,{type:0,text:s.text,textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified})))))}catch{}return n};return l.findByTypeNameAll("UserRow").forEach(function(r){return o.push(p.after("type",r,e))}),function(){o.forEach(function(r){try{r?.()}catch{}})}}const v=l.findByName("DisplayName",!1),G=l.findByName("HeaderName",!1),x=l.findByProps("getBotLabel"),M=x?.getBotLabel,V=l.findByStoreName("GuildStore"),H=l.findByStoreName("ChannelStore");function K(){const o=[];return G&&o.push(p.after("default",G,function(e,r){let[{channelId:n}]=e;try{r?.props&&(r.props.channelId=n)}catch(a){console.error("Staff Tags - HeaderName patch error:",a)}})),v&&o.push(p.after("default",v,function(e,r){let[{guildId:n,channelId:a,user:t}]=e;try{if(!r||!M)return;const i=S.findInReactTree(r,function(s){return s?.type?.Types});if(!i||!R.includes(M(i.props?.type))){const s=V?.getGuild?.(n),g=H?.getChannel?.(a),f=T(s,g,t);if(f&&x?.default)if(i)i.props={type:0,...f};else{const h=S.findInReactTree(r,function(Z){return Z?.props?.style?.flexDirection==="row"});h?.props?.children&&Array.isArray(h.props.children)&&h.props.children.push(React.createElement(x.default,{style:{marginLeft:0},type:0,text:f.text,textColor:f.textColor,backgroundColor:f.backgroundColor,verified:f.verified}))}}}catch(i){console.error("Staff Tags - DisplayName patch error:",i)}})),function(){return o.forEach(function(e){try{e?.()}catch(r){console.error("Staff Tags - Name unpatch error:",r)}})}}const I=l.findByName("RowManager"),W=l.findByStoreName("GuildStore");function j(){return I?p.before("generate",I.prototype,function(o){let[e]=o;try{if(e?.message?.author||e?.user){const r=e.message?.author||e.user,n=e.guildId||e.message?.guild_id;if(r&&n){const a=W?.getGuild?.(n),t=T(a,null,r);t&&(e.text&&(e.text=e.text+` ${t.text}`),t.backgroundColor&&e.roleStyle!==void 0&&(e.roleStyle=t.backgroundColor))}}}catch{}}):function(){}}const F=l.findByProps("getBotLabel");function X(){return p.after("default",F,function(o,e){let[{text:r,textColor:n,backgroundColor:a}]=o;try{const t=S.findInReactTree(e,function(i){return typeof i?.props?.children=="string"});t?.props&&(r&&(t.props.children=r),n&&(t.props.style||(t.props.style=[]),Array.isArray(t.props.style)?t.props.style.push({color:n}):t.props.style=[t.props.style,{color:n}])),a&&e?.props&&(e.props.style||(e.props.style=[]),Array.isArray(e.props.style)?e.props.style.push({backgroundColor:a}):e.props.style=[e.props.style,{backgroundColor:a}])}catch(t){console.error("Staff Tags - Tag patch error:",t)}})}const{ScrollView:Y}=E.General,{FormSection:q,FormSwitchRow:z}=E.Forms;function J(){return m.useProxy(y.storage),React.createElement(Y,{style:{flex:1}},React.createElement(q,{title:"Tag style"},React.createElement(z,{label:"Use top role color for tag backgrounds",value:y.storage.useRoleColor,onValueChange:function(o){y.storage.useRoleColor=o}})))}let d=[];var Q={onLoad:function(){try{y.storage.useRoleColor??=!1,d.push(P()),d.push(X()),d.push(K()),d.push(j()),d.push($()),console.log("Staff Tags loaded successfully")}catch(o){throw console.error("Staff Tags - Load error:",o),o}},onUnload:function(){try{d.forEach(function(o){try{o?.()}catch(e){console.error("Staff Tags - Unpatch error:",e)}}),d=[],console.log("Staff Tags unloaded successfully")}catch(o){console.error("Staff Tags - Unload error:",o)}},settings:J};return C.default=Q,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.ui.components,vendetta.storage);
